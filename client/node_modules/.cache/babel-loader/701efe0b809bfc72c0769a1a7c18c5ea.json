{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    if (typeof b !== \"function\" && b !== null) throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spreadArray = this && this.__spreadArray || function (to, from, pack) {\n  if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n    if (ar || !(i in from)) {\n      if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n      ar[i] = from[i];\n    }\n  }\n  return to.concat(ar || Array.prototype.slice.call(from));\n};\n/* eslint-disable camelcase */\n\n\nimport * as React from 'react';\nimport memoize from 'memoize-one';\nimport Actions from './components/Actions';\nimport Content from './components/Content';\nimport Controls from './components/Controls';\nimport ErrorMessage from './components/ErrorMessage';\nimport Info from './components/Info';\nimport Loader from './components/Loader';\nimport Player from './components/Player';\nimport Slider from './components/Slider';\nimport { getDevices, getPlaybackState, next, pause, play, previous, seek, setDevice, setVolume } from './spotify';\nimport { getMergedStyles } from './styles';\nimport { getLocale, getSpotifyURIType, isEqualArray, loadSpotifyPlayer, parseVolume, round, STATUS, TYPE, validateURI } from './utils';\n\nvar SpotifyWebPlayer =\n/** @class */\nfunction (_super) {\n  __extends(SpotifyWebPlayer, _super);\n\n  function SpotifyWebPlayer(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.isActive = false;\n    _this.emptyTrack = {\n      artists: [],\n      durationMs: 0,\n      id: '',\n      image: '',\n      name: '',\n      uri: ''\n    };\n    _this.getPlayOptions = memoize(function (data) {\n      var playOptions = {\n        context_uri: undefined,\n        uris: undefined\n      };\n      /* istanbul ignore else */\n\n      if (data) {\n        var ids = Array.isArray(data) ? data : [data];\n\n        if (!ids.every(function (d) {\n          return validateURI(d);\n        })) {\n          // eslint-disable-next-line no-console\n          console.error('Invalid URI');\n          return playOptions;\n        }\n\n        if (ids.some(function (d) {\n          return getSpotifyURIType(d) === 'track';\n        })) {\n          if (!ids.every(function (d) {\n            return getSpotifyURIType(d) === 'track';\n          })) {\n            // eslint-disable-next-line no-console\n            console.warn(\"You can't mix tracks URIs with other types\");\n          }\n\n          playOptions.uris = ids.filter(function (d) {\n            return validateURI(d) && getSpotifyURIType(d) === 'track';\n          });\n        } else {\n          if (ids.length > 1) {\n            // eslint-disable-next-line no-console\n            console.warn(\"Albums, Artists, Playlists and Podcasts can't have multiple URIs\");\n          } // eslint-disable-next-line prefer-destructuring\n\n\n          playOptions.context_uri = ids[0];\n        }\n      }\n\n      return playOptions;\n    });\n    _this.hasNewToken = false;\n    _this.ref = React.createRef();\n    _this.seekUpdateInterval = 100;\n\n    _this.handleChangeRange = function (position) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var track, _a, callback, token, progress, percentage, state, error_1;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              track = this.state.track;\n              _a = this.props, callback = _a.callback, token = _a.token;\n              progress = 0;\n              _b.label = 1;\n\n            case 1:\n              _b.trys.push([1, 8,, 9]);\n\n              percentage = position / 100;\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 3];\n              progress = Math.round(track.durationMs * percentage);\n              return [4\n              /*yield*/\n              , seek(token, progress)];\n\n            case 2:\n              _b.sent();\n\n              this.updateState({\n                position: position,\n                progressMs: progress\n              });\n              return [3\n              /*break*/\n              , 7];\n\n            case 3:\n              if (!this.player) return [3\n              /*break*/\n              , 7];\n              return [4\n              /*yield*/\n              , this.player.getCurrentState()];\n\n            case 4:\n              state = _b.sent();\n              if (!state) return [3\n              /*break*/\n              , 6];\n              progress = Math.round(state.track_window.current_track.duration_ms * percentage);\n              return [4\n              /*yield*/\n              , this.player.seek(progress)];\n\n            case 5:\n              _b.sent();\n\n              this.updateState({\n                position: position,\n                progressMs: progress\n              });\n              return [3\n              /*break*/\n              , 7];\n\n            case 6:\n              this.updateState({\n                position: 0\n              });\n              _b.label = 7;\n\n            case 7:\n              if (callback) {\n                callback(__assign(__assign({}, this.state), {\n                  type: TYPE.PROGRESS\n                }));\n              }\n\n              return [3\n              /*break*/\n              , 9];\n\n            case 8:\n              error_1 = _b.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_1);\n              return [3\n              /*break*/\n              , 9];\n\n            case 9:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleClickTogglePlay = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var isActive, error_2;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              isActive = this.state.isActive;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , this.togglePlay(!this.isExternalPlayer && !isActive)];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              error_2 = _a.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_2);\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleClickPrevious = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token, error_3;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 5,, 6]);\n\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 2];\n              token = this.props.token;\n              return [4\n              /*yield*/\n              , previous(token)];\n\n            case 1:\n              _a.sent();\n\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3\n              /*break*/\n              , 4];\n\n            case 2:\n              if (!this.player) return [3\n              /*break*/\n              , 4];\n              return [4\n              /*yield*/\n              , this.player.previousTrack()];\n\n            case 3:\n              _a.sent();\n\n              _a.label = 4;\n\n            case 4:\n              return [3\n              /*break*/\n              , 6];\n\n            case 5:\n              error_3 = _a.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_3);\n              return [3\n              /*break*/\n              , 6];\n\n            case 6:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleClickNext = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token, error_4;\n\n        var _this = this;\n\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              _a.trys.push([0, 5,, 6]);\n\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 2];\n              token = this.props.token;\n              return [4\n              /*yield*/\n              , next(token)];\n\n            case 1:\n              _a.sent();\n\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3\n              /*break*/\n              , 4];\n\n            case 2:\n              if (!this.player) return [3\n              /*break*/\n              , 4];\n              return [4\n              /*yield*/\n              , this.player.nextTrack()];\n\n            case 3:\n              _a.sent();\n\n              _a.label = 4;\n\n            case 4:\n              return [3\n              /*break*/\n              , 6];\n\n            case 5:\n              error_4 = _a.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_4);\n              return [3\n              /*break*/\n              , 6];\n\n            case 6:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleClickDevice = function (deviceId) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var isUnsupported, _a, autoPlay, persistDeviceSelection, token, player, error_5;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              isUnsupported = this.state.isUnsupported;\n              _a = this.props, autoPlay = _a.autoPlay, persistDeviceSelection = _a.persistDeviceSelection, token = _a.token;\n              this.updateState({\n                currentDeviceId: deviceId\n              });\n              _b.label = 1;\n\n            case 1:\n              _b.trys.push([1, 7,, 8]);\n\n              return [4\n              /*yield*/\n              , setDevice(token, deviceId)];\n\n            case 2:\n              _b.sent();\n              /* istanbul ignore else */\n\n\n              if (persistDeviceSelection) {\n                sessionStorage.setItem('rswpDeviceId', deviceId);\n              }\n\n              if (!isUnsupported) return [3\n              /*break*/\n              , 6];\n              return [4\n              /*yield*/\n              , this.syncDevice()];\n\n            case 3:\n              _b.sent();\n\n              return [4\n              /*yield*/\n              , getPlaybackState(token)];\n\n            case 4:\n              player = _b.sent();\n              if (!(player && !player.is_playing && autoPlay)) return [3\n              /*break*/\n              , 6];\n              return [4\n              /*yield*/\n              , this.togglePlay(true)];\n\n            case 5:\n              _b.sent();\n\n              _b.label = 6;\n\n            case 6:\n              return [3\n              /*break*/\n              , 8];\n\n            case 7:\n              error_5 = _b.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_5);\n              return [3\n              /*break*/\n              , 8];\n\n            case 8:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleFavoriteStatusChange = function (status) {\n      var isSaved = _this.state.isSaved;\n      var callback = _this.props.callback;\n\n      _this.updateState({\n        isSaved: status\n      });\n      /* istanbul ignore else */\n\n\n      if (isSaved !== status) {\n        callback(__assign(__assign({}, _this.state), {\n          isSaved: status,\n          type: TYPE.FAVORITE\n        }));\n      }\n    };\n\n    _this.handlePlayerErrors = function (type, message) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var status, isPlaybackError, isInitializationError, nextStatus, devices, token;\n\n        var _a;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              status = this.state.status;\n              isPlaybackError = type === 'playback_error';\n              isInitializationError = type === 'initialization_error';\n              nextStatus = status;\n              devices = [];\n              if (!(this.player && !isPlaybackError)) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , this.player.disconnect()];\n\n            case 1:\n              _b.sent();\n\n              _b.label = 2;\n\n            case 2:\n              if (!isInitializationError) return [3\n              /*break*/\n              , 4];\n              nextStatus = STATUS.UNSUPPORTED;\n              token = this.props.token;\n              return [4\n              /*yield*/\n              , getDevices(token)];\n\n            case 3:\n              _a = _b.sent().devices, devices = _a === void 0 ? [] : _a;\n              _b.label = 4;\n\n            case 4:\n              if (!isInitializationError && !isPlaybackError) {\n                nextStatus = STATUS.ERROR;\n              }\n\n              this.updateState({\n                devices: devices,\n                error: message,\n                errorType: type,\n                isInitializing: false,\n                isUnsupported: isInitializationError,\n                status: nextStatus\n              });\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handlePlayerStateChanges = function (state) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var paused, position, _a, _b, album, artists, duration_ms, id, name_1, uri, next_tracks, previous_tracks, isPlaying, volume, track, trackState, error_6;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              _c.trys.push([0, 6,, 7]);\n\n              if (!state) return [3\n              /*break*/\n              , 2];\n              paused = state.paused, position = state.position, _a = state.track_window, _b = _a.current_track, album = _b.album, artists = _b.artists, duration_ms = _b.duration_ms, id = _b.id, name_1 = _b.name, uri = _b.uri, next_tracks = _a.next_tracks, previous_tracks = _a.previous_tracks;\n              isPlaying = !paused;\n              return [4\n              /*yield*/\n              , this.player.getVolume()];\n\n            case 1:\n              volume = _c.sent();\n              track = {\n                artists: artists,\n                durationMs: duration_ms,\n                id: id,\n                image: this.setAlbumImage(album),\n                name: name_1,\n                uri: uri\n              };\n              trackState = void 0;\n\n              if (position === 0) {\n                trackState = {\n                  nextTracks: next_tracks,\n                  position: 0,\n                  previousTracks: previous_tracks,\n                  track: track\n                };\n              }\n\n              this.updateState(__assign({\n                error: '',\n                errorType: '',\n                isActive: true,\n                isPlaying: isPlaying,\n                progressMs: position,\n                volume: round(volume)\n              }, trackState));\n              return [3\n              /*break*/\n              , 5];\n\n            case 2:\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 4];\n              return [4\n              /*yield*/\n              , this.syncDevice()];\n\n            case 3:\n              _c.sent();\n\n              return [3\n              /*break*/\n              , 5];\n\n            case 4:\n              this.updateState({\n                isActive: false,\n                isPlaying: false,\n                nextTracks: [],\n                position: 0,\n                previousTracks: [],\n                track: {\n                  artists: '',\n                  durationMs: 0,\n                  id: '',\n                  image: '',\n                  name: '',\n                  uri: ''\n                }\n              });\n              _c.label = 5;\n\n            case 5:\n              return [3\n              /*break*/\n              , 7];\n\n            case 6:\n              error_6 = _c.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_6);\n              return [3\n              /*break*/\n              , 7];\n\n            case 7:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handlePlayerStatus = function (_a) {\n      var device_id = _a.device_id;\n      return __awaiter(_this, void 0, void 0, function () {\n        var _b, currentDeviceId, devices;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              return [4\n              /*yield*/\n              , this.initializeDevices(device_id)];\n\n            case 1:\n              _b = _c.sent(), currentDeviceId = _b.currentDeviceId, devices = _b.devices;\n              this.updateState({\n                currentDeviceId: currentDeviceId,\n                deviceId: device_id,\n                devices: devices,\n                isInitializing: false,\n                status: device_id ? STATUS.READY : STATUS.IDLE\n              });\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.handleToggleMagnify = function () {\n      var magnifySliderOnHover = _this.props.magnifySliderOnHover;\n\n      if (magnifySliderOnHover) {\n        _this.updateState(function (previousState) {\n          return {\n            isMagnified: !previousState.isMagnified\n          };\n        });\n      }\n    };\n\n    _this.initializePlayer = function () {\n      var volume = _this.state.volume;\n      var _a = _this.props,\n          name = _a.name,\n          token = _a.token;\n\n      _this.updateState({\n        isInitializing: true\n      }); // @ts-ignore\n\n\n      _this.player = new window.Spotify.Player({\n        getOAuthToken: function (callback) {\n          callback(token);\n        },\n        name: name,\n        volume: volume\n      });\n\n      _this.player.addListener('ready', _this.handlePlayerStatus);\n\n      _this.player.addListener('not_ready', _this.handlePlayerStatus);\n\n      _this.player.addListener('player_state_changed', _this.handlePlayerStateChanges);\n\n      _this.player.addListener('initialization_error', function (error) {\n        return _this.handlePlayerErrors('initialization_error', error.message);\n      });\n\n      _this.player.addListener('authentication_error', function (error) {\n        return _this.handlePlayerErrors('authentication_error', error.message);\n      });\n\n      _this.player.addListener('account_error', function (error) {\n        return _this.handlePlayerErrors('account_error', error.message);\n      });\n\n      _this.player.addListener('playback_error', function (error) {\n        return _this.handlePlayerErrors('playback_error', error.message);\n      });\n\n      _this.player.connect();\n    }; // eslint-disable-next-line class-methods-use-this\n\n\n    _this.setAlbumImage = function (album) {\n      var width = Math.min.apply(Math, __spreadArray([], __read(album.images.map(function (d) {\n        return d.width;\n      })), false));\n      var thumb = album.images.find(function (d) {\n        return d.width === width;\n      }) || {};\n      return thumb.url;\n    };\n\n    _this.setExternalDevice = function (id) {\n      _this.updateState({\n        currentDeviceId: id,\n        isPlaying: true\n      });\n    };\n\n    _this.setVolume = function (volume) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var token;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              token = this.props.token;\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 3];\n              return [4\n              /*yield*/\n              , setVolume(token, Math.round(volume * 100))];\n\n            case 1:\n              _a.sent();\n\n              return [4\n              /*yield*/\n              , this.syncDevice()];\n\n            case 2:\n              _a.sent();\n\n              return [3\n              /*break*/\n              , 5];\n\n            case 3:\n              if (!this.player) return [3\n              /*break*/\n              , 5];\n              return [4\n              /*yield*/\n              , this.player.setVolume(volume)];\n\n            case 4:\n              _a.sent();\n\n              _a.label = 5;\n\n            case 5:\n              this.updateState({\n                volume: volume\n              });\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.syncDevice = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var deviceId, token, player, track, error_7, state;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              if (!this.isActive) {\n                return [2\n                /*return*/\n                ];\n              }\n\n              deviceId = this.state.deviceId;\n              token = this.props.token;\n              _a.label = 1;\n\n            case 1:\n              _a.trys.push([1, 3,, 4]);\n\n              return [4\n              /*yield*/\n              , getPlaybackState(token)];\n\n            case 2:\n              player = _a.sent();\n              track = this.emptyTrack;\n\n              if (!player) {\n                throw new Error('No player');\n              }\n              /* istanbul ignore else */\n\n\n              if (player.item) {\n                track = {\n                  artists: player.item.artists,\n                  durationMs: player.item.duration_ms,\n                  id: player.item.id,\n                  image: this.setAlbumImage(player.item.album),\n                  name: player.item.name,\n                  uri: player.item.uri\n                };\n              }\n\n              this.updateState({\n                error: '',\n                errorType: '',\n                isActive: true,\n                isPlaying: player.is_playing,\n                nextTracks: [],\n                previousTracks: [],\n                progressMs: player.item ? player.progress_ms : 0,\n                status: STATUS.READY,\n                track: track,\n                volume: parseVolume(player.device.volume_percent)\n              });\n              return [3\n              /*break*/\n              , 4];\n\n            case 3:\n              error_7 = _a.sent();\n              state = {\n                isActive: false,\n                isPlaying: false,\n                position: 0,\n                track: this.emptyTrack\n              };\n\n              if (deviceId) {\n                this.updateState(__assign({\n                  currentDeviceId: deviceId\n                }, state));\n                return [2\n                /*return*/\n                ];\n              }\n\n              this.updateState(__assign({\n                error: error_7.message,\n                errorType: 'player_status',\n                status: STATUS.ERROR\n              }, state));\n              return [3\n              /*break*/\n              , 4];\n\n            case 4:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.toggleOffset = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, currentDeviceId, isPlaying, _b, offset, token, uris;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying;\n              _b = this.props, offset = _b.offset, token = _b.token, uris = _b.uris;\n              if (!(isPlaying && typeof offset === 'number' && Array.isArray(uris))) return [3\n              /*break*/\n              , 2];\n              return [4\n              /*yield*/\n              , play(token, {\n                deviceId: currentDeviceId,\n                offset: offset,\n                uris: uris\n              })];\n\n            case 1:\n              _c.sent();\n\n              _c.label = 2;\n\n            case 2:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.togglePlay = function (init) {\n      if (init === void 0) {\n        init = false;\n      }\n\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, currentDeviceId, isPlaying, needsUpdate, _b, offset, token, uris, shouldInitialize, playOptions, playerState, error_8;\n\n        var _this = this;\n\n        return __generator(this, function (_c) {\n          switch (_c.label) {\n            case 0:\n              _a = this.state, currentDeviceId = _a.currentDeviceId, isPlaying = _a.isPlaying, needsUpdate = _a.needsUpdate;\n              _b = this.props, offset = _b.offset, token = _b.token, uris = _b.uris;\n              shouldInitialize = init || needsUpdate;\n              playOptions = this.getPlayOptions(uris);\n              _c.label = 1;\n\n            case 1:\n              _c.trys.push([1, 12,, 13]);\n\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 6];\n              if (!!isPlaying) return [3\n              /*break*/\n              , 3];\n              return [4\n              /*yield*/\n              , play(token, __assign({\n                deviceId: currentDeviceId,\n                offset: offset\n              }, shouldInitialize ? playOptions : undefined))];\n\n            case 2:\n              _c.sent();\n\n              return [3\n              /*break*/\n              , 5];\n\n            case 3:\n              return [4\n              /*yield*/\n              , pause(token)];\n\n            case 4:\n              _c.sent();\n\n              this.updateState({\n                isPlaying: false\n              });\n              _c.label = 5;\n\n            case 5:\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 300);\n              return [3\n              /*break*/\n              , 11];\n\n            case 6:\n              if (!this.player) return [3\n              /*break*/\n              , 11];\n              return [4\n              /*yield*/\n              , this.player.getCurrentState()];\n\n            case 7:\n              playerState = _c.sent();\n              this.player.activateElement();\n              if (!(!playerState && !!(playOptions.context_uri || playOptions.uris) || shouldInitialize && playerState && playerState.paused)) return [3\n              /*break*/\n              , 9];\n              return [4\n              /*yield*/\n              , play(token, __assign({\n                deviceId: currentDeviceId,\n                offset: offset\n              }, shouldInitialize ? playOptions : undefined))];\n\n            case 8:\n              _c.sent();\n\n              return [3\n              /*break*/\n              , 11];\n\n            case 9:\n              return [4\n              /*yield*/\n              , this.player.togglePlay()];\n\n            case 10:\n              _c.sent();\n\n              _c.label = 11;\n\n            case 11:\n              if (needsUpdate) {\n                this.updateState({\n                  needsUpdate: false\n                });\n              }\n\n              return [3\n              /*break*/\n              , 13];\n\n            case 12:\n              error_8 = _c.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_8);\n              return [3\n              /*break*/\n              , 13];\n\n            case 13:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.updateSeekBar = function () {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, progressMs, track, position, state, progress, position, error_9;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!this.isActive) {\n                return [2\n                /*return*/\n                ];\n              }\n\n              _a = this.state, progressMs = _a.progressMs, track = _a.track;\n              _b.label = 1;\n\n            case 1:\n              _b.trys.push([1, 5,, 6]);\n\n              if (!this.isExternalPlayer) return [3\n              /*break*/\n              , 2];\n              position = progressMs / track.durationMs;\n              position = Number(((Number.isFinite(position) ? position : 0) * 100).toFixed(1));\n              this.updateState({\n                position: position,\n                progressMs: progressMs + this.seekUpdateInterval\n              });\n              return [3\n              /*break*/\n              , 4];\n\n            case 2:\n              if (!this.player) return [3\n              /*break*/\n              , 4];\n              return [4\n              /*yield*/\n              , this.player.getCurrentState()];\n\n            case 3:\n              state = _b.sent();\n              /* istanbul ignore else */\n\n              if (state) {\n                progress = state.position;\n                position = Number((progress / state.track_window.current_track.duration_ms * 100).toFixed(1));\n                this.updateState({\n                  position: position,\n                  progressMs: progress + this.seekUpdateInterval\n                });\n              }\n\n              _b.label = 4;\n\n            case 4:\n              return [3\n              /*break*/\n              , 6];\n\n            case 5:\n              error_9 = _b.sent(); // eslint-disable-next-line no-console\n\n              console.error(error_9);\n              return [3\n              /*break*/\n              , 6];\n\n            case 6:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    };\n\n    _this.updateState = function (state) {\n      if (state === void 0) {\n        state = {};\n      }\n\n      if (!_this.isActive) {\n        return;\n      }\n\n      _this.setState(state);\n    };\n\n    _this.state = {\n      currentDeviceId: '',\n      deviceId: '',\n      devices: [],\n      error: '',\n      errorType: '',\n      isActive: false,\n      isInitializing: false,\n      isMagnified: false,\n      isPlaying: false,\n      isSaved: false,\n      isUnsupported: false,\n      needsUpdate: false,\n      nextTracks: [],\n      playerPosition: 'bottom',\n      position: 0,\n      previousTracks: [],\n      progressMs: 0,\n      status: STATUS.IDLE,\n      track: _this.emptyTrack,\n      volume: parseVolume(props.initialVolume) || 1\n    };\n    _this.styles = getMergedStyles(props.styles);\n    return _this;\n  }\n\n  SpotifyWebPlayer.prototype.componentDidMount = function () {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function () {\n      var _b, top;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            this.isActive = true;\n            _b = (((_a = this.ref.current) === null || _a === void 0 ? void 0 : _a.getBoundingClientRect()) || {}).top, top = _b === void 0 ? 0 : _b;\n            this.updateState({\n              playerPosition: top > window.innerHeight / 2 ? 'bottom' : 'top',\n              status: STATUS.INITIALIZING\n            });\n\n            if (!window.onSpotifyWebPlaybackSDKReady) {\n              window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n            } else {\n              this.initializePlayer();\n            }\n\n            return [4\n            /*yield*/\n            , loadSpotifyPlayer()];\n\n          case 1:\n            _c.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.componentDidUpdate = function (previousProps, previousState) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, currentDeviceId, deviceId, error, isInitializing, isPlaying, status, track, _b, autoPlay, callback, offset, playProp, showSaveIcon, syncExternalDevice, token, uris, isReady, changedURIs, playOptions, canPlay, shouldPlay, player;\n\n      var _this = this;\n\n      return __generator(this, function (_c) {\n        switch (_c.label) {\n          case 0:\n            _a = this.state, currentDeviceId = _a.currentDeviceId, deviceId = _a.deviceId, error = _a.error, isInitializing = _a.isInitializing, isPlaying = _a.isPlaying, status = _a.status, track = _a.track;\n            _b = this.props, autoPlay = _b.autoPlay, callback = _b.callback, offset = _b.offset, playProp = _b.play, showSaveIcon = _b.showSaveIcon, syncExternalDevice = _b.syncExternalDevice, token = _b.token, uris = _b.uris;\n            isReady = previousState.status !== STATUS.READY && status === STATUS.READY;\n            changedURIs = Array.isArray(uris) ? !isEqualArray(previousProps.uris, uris) : previousProps.uris !== uris;\n            playOptions = this.getPlayOptions(uris);\n            canPlay = !!currentDeviceId && !!(playOptions.context_uri || playOptions.uris);\n            shouldPlay = changedURIs && isPlaying || !!(isReady && (autoPlay || playProp));\n            if (!(canPlay && shouldPlay)) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , play(token, __assign({\n              deviceId: currentDeviceId,\n              offset: offset\n            }, playOptions))];\n\n          case 1:\n            _c.sent();\n            /* istanbul ignore else */\n\n\n            if (!isPlaying) {\n              this.updateState({\n                isPlaying: true\n              });\n            }\n\n            if (this.isExternalPlayer) {\n              this.syncTimeout = window.setTimeout(function () {\n                _this.syncDevice();\n              }, 600);\n            }\n\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            if (changedURIs && !isPlaying) {\n              this.updateState({\n                needsUpdate: true\n              });\n            }\n\n            _c.label = 3;\n\n          case 3:\n            if (previousState.status !== status) {\n              callback(__assign(__assign({}, this.state), {\n                type: TYPE.STATUS\n              }));\n            }\n\n            if (!(previousState.currentDeviceId !== currentDeviceId && currentDeviceId)) return [3\n            /*break*/\n            , 6];\n\n            if (!isReady) {\n              callback(__assign(__assign({}, this.state), {\n                type: TYPE.DEVICE\n              }));\n            }\n\n            return [4\n            /*yield*/\n            , this.toggleSyncInterval(this.isExternalPlayer)];\n\n          case 4:\n            _c.sent();\n\n            return [4\n            /*yield*/\n            , this.updateSeekBar()];\n\n          case 5:\n            _c.sent();\n\n            _c.label = 6;\n\n          case 6:\n            if (previousState.track.id !== track.id && track.id) {\n              callback(__assign(__assign({}, this.state), {\n                type: TYPE.TRACK\n              }));\n\n              if (showSaveIcon) {\n                this.updateState({\n                  isSaved: false\n                });\n              }\n            }\n\n            if (!(previousState.isPlaying !== isPlaying)) return [3\n            /*break*/\n            , 8];\n            this.toggleProgressBar();\n            return [4\n            /*yield*/\n            , this.toggleSyncInterval(this.isExternalPlayer)];\n\n          case 7:\n            _c.sent();\n\n            callback(__assign(__assign({}, this.state), {\n              type: TYPE.PLAYER\n            }));\n            _c.label = 8;\n\n          case 8:\n            if (token && previousProps.token !== token) {\n              this.hasNewToken = true;\n\n              if (!isInitializing) {\n                this.initializePlayer();\n              } else {\n                this.hasNewToken = true;\n              }\n            }\n\n            if (!(previousProps.play !== playProp && playProp !== isPlaying)) return [3\n            /*break*/\n            , 10];\n            return [4\n            /*yield*/\n            , this.togglePlay(!track.id)];\n\n          case 9:\n            _c.sent();\n\n            _c.label = 10;\n\n          case 10:\n            if (!(previousProps.offset !== offset)) return [3\n            /*break*/\n            , 12];\n            return [4\n            /*yield*/\n            , this.toggleOffset()];\n\n          case 11:\n            _c.sent();\n\n            _c.label = 12;\n\n          case 12:\n            if (!(previousState.isInitializing && !isInitializing)) return [3\n            /*break*/\n            , 14];\n\n            if (error === 'authentication_error' && this.hasNewToken) {\n              this.hasNewToken = false;\n              this.initializePlayer();\n            }\n\n            if (!(syncExternalDevice && !uris)) return [3\n            /*break*/\n            , 14];\n            return [4\n            /*yield*/\n            , getPlaybackState(token)];\n\n          case 13:\n            player = _c.sent();\n            /* istanbul ignore else */\n\n            if (player && player.is_playing && player.device.id !== deviceId) {\n              this.setExternalDevice(player.device.id);\n            }\n\n            _c.label = 14;\n\n          case 14:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.componentWillUnmount = function () {\n    this.isActive = false;\n    /* istanbul ignore else */\n\n    if (this.player) {\n      this.player.disconnect();\n    }\n\n    clearInterval(this.playerSyncInterval);\n    clearInterval(this.playerProgressInterval);\n    clearTimeout(this.syncTimeout);\n  };\n\n  Object.defineProperty(SpotifyWebPlayer.prototype, \"isExternalPlayer\", {\n    get: function () {\n      var _a = this.state,\n          currentDeviceId = _a.currentDeviceId,\n          deviceId = _a.deviceId,\n          status = _a.status;\n      return currentDeviceId && currentDeviceId !== deviceId || status === STATUS.UNSUPPORTED;\n    },\n    enumerable: false,\n    configurable: true\n  });\n\n  SpotifyWebPlayer.prototype.initializeDevices = function (id) {\n    return __awaiter(this, void 0, void 0, function () {\n      var _a, persistDeviceSelection, token, devices, currentDeviceId, savedDeviceId_1;\n\n      return __generator(this, function (_b) {\n        switch (_b.label) {\n          case 0:\n            _a = this.props, persistDeviceSelection = _a.persistDeviceSelection, token = _a.token;\n            return [4\n            /*yield*/\n            , getDevices(token)];\n\n          case 1:\n            devices = _b.sent().devices;\n            currentDeviceId = id;\n\n            if (persistDeviceSelection) {\n              savedDeviceId_1 = sessionStorage.getItem('rswpDeviceId');\n              /* istanbul ignore else */\n\n              if (!savedDeviceId_1 || !devices.some(function (d) {\n                return d.id === savedDeviceId_1;\n              })) {\n                sessionStorage.setItem('rswpDeviceId', currentDeviceId);\n              } else {\n                currentDeviceId = savedDeviceId_1;\n              }\n            }\n\n            return [2\n            /*return*/\n            , {\n              currentDeviceId: currentDeviceId,\n              devices: devices\n            }];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.toggleSyncInterval = function (shouldSync) {\n    return __awaiter(this, void 0, void 0, function () {\n      var syncExternalDeviceInterval, error_10;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            syncExternalDeviceInterval = this.props.syncExternalDeviceInterval;\n            _a.label = 1;\n\n          case 1:\n            _a.trys.push([1, 4,, 5]);\n\n            if (!(this.isExternalPlayer && shouldSync && !this.playerSyncInterval)) return [3\n            /*break*/\n            , 3];\n            return [4\n            /*yield*/\n            , this.syncDevice()];\n\n          case 2:\n            _a.sent();\n\n            clearInterval(this.playerSyncInterval);\n            this.playerSyncInterval = window.setInterval(this.syncDevice, syncExternalDeviceInterval * 1000);\n            _a.label = 3;\n\n          case 3:\n            if ((!shouldSync || !this.isExternalPlayer) && this.playerSyncInterval) {\n              clearInterval(this.playerSyncInterval);\n              this.playerSyncInterval = undefined;\n            }\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            error_10 = _a.sent(); // eslint-disable-next-line no-console\n\n            console.error(error_10);\n            return [3\n            /*break*/\n            , 5];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SpotifyWebPlayer.prototype.toggleProgressBar = function () {\n    var isPlaying = this.state.isPlaying;\n    /* istanbul ignore else */\n\n    if (isPlaying) {\n      /* istanbul ignore else */\n      if (!this.playerProgressInterval) {\n        this.playerProgressInterval = window.setInterval(this.updateSeekBar, this.seekUpdateInterval);\n      }\n    } else if (this.playerProgressInterval) {\n      clearInterval(this.playerProgressInterval);\n      this.playerProgressInterval = undefined;\n    }\n  };\n\n  SpotifyWebPlayer.prototype.render = function () {\n    var _a = this.state,\n        currentDeviceId = _a.currentDeviceId,\n        deviceId = _a.deviceId,\n        devices = _a.devices,\n        error = _a.error,\n        errorType = _a.errorType,\n        isActive = _a.isActive,\n        isMagnified = _a.isMagnified,\n        isPlaying = _a.isPlaying,\n        isUnsupported = _a.isUnsupported,\n        nextTracks = _a.nextTracks,\n        playerPosition = _a.playerPosition,\n        position = _a.position,\n        previousTracks = _a.previousTracks,\n        status = _a.status,\n        track = _a.track,\n        volume = _a.volume;\n    var _b = this.props,\n        locale = _b.locale,\n        name = _b.name,\n        showSaveIcon = _b.showSaveIcon,\n        token = _b.token,\n        updateSavedStatus = _b.updateSavedStatus;\n    var isReady = [STATUS.READY, STATUS.UNSUPPORTED].indexOf(status) >= 0;\n    var isPlaybackError = errorType === 'playback_error';\n    var localeMerged = getLocale(locale);\n    var output = React.createElement(Loader, {\n      styles: this.styles\n    });\n    var info;\n\n    if (isPlaybackError) {\n      info = React.createElement(\"p\", null, error);\n    }\n\n    if (isReady) {\n      /* istanbul ignore else */\n      if (!info) {\n        info = React.createElement(Info, {\n          isActive: isActive,\n          locale: localeMerged,\n          onFavoriteStatusChange: this.handleFavoriteStatusChange,\n          showSaveIcon: showSaveIcon,\n          styles: this.styles,\n          token: token,\n          track: track,\n          updateSavedStatus: updateSavedStatus\n        });\n      }\n\n      output = React.createElement(React.Fragment, null, React.createElement(\"div\", null, info), React.createElement(Controls, {\n        isExternalDevice: this.isExternalPlayer,\n        isPlaying: isPlaying,\n        locale: localeMerged,\n        nextTracks: nextTracks,\n        onClickNext: this.handleClickNext,\n        onClickPrevious: this.handleClickPrevious,\n        onClickTogglePlay: this.handleClickTogglePlay,\n        previousTracks: previousTracks,\n        styles: this.styles\n      }), React.createElement(Actions, {\n        currentDeviceId: currentDeviceId,\n        deviceId: deviceId,\n        devices: devices,\n        isDevicesOpen: isUnsupported && !deviceId,\n        locale: localeMerged,\n        onClickDevice: this.handleClickDevice,\n        playerPosition: playerPosition,\n        setVolume: this.setVolume,\n        styles: this.styles,\n        volume: volume\n      }));\n    }\n\n    if (status === STATUS.ERROR) {\n      output = React.createElement(ErrorMessage, {\n        styles: this.styles\n      }, name, \": \", error);\n    }\n\n    return React.createElement(Player, {\n      ref: this.ref,\n      styles: this.styles\n    }, isReady && React.createElement(Slider, {\n      isMagnified: isMagnified,\n      onChangeRange: this.handleChangeRange,\n      onToggleMagnify: this.handleToggleMagnify,\n      position: position,\n      styles: this.styles\n    }), React.createElement(Content, {\n      styles: this.styles\n    }, output));\n  }; // eslint-disable-next-line react/static-property-placement\n\n\n  SpotifyWebPlayer.defaultProps = {\n    callback: function () {\n      return undefined;\n    },\n    magnifySliderOnHover: false,\n    name: 'Spotify Web Player',\n    showSaveIcon: false,\n    syncExternalDeviceInterval: 5,\n    syncExternalDevice: false\n  };\n  return SpotifyWebPlayer;\n}(React.PureComponent);\n\nexport * from './types';\nexport default SpotifyWebPlayer;\nexport { STATUS, TYPE } from './utils';","map":{"version":3,"mappings":"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","names":["React","memoize","Actions","Content","Controls","ErrorMessage","Info","Loader","Player","Slider","getDevices","getPlaybackState","next","pause","play","previous","seek","setDevice","setVolume","getMergedStyles","getLocale","getSpotifyURIType","isEqualArray","loadSpotifyPlayer","parseVolume","round","STATUS","TYPE","validateURI","__extends","props","_super","_this","artists","durationMs","id","image","name","uri","data","playOptions","context_uri","undefined","uris","ids","Array","isArray","every","d","console","error","some","warn","filter","length","createRef","position","track","state","_a","callback","token","progress","percentage","isExternalPlayer","Math","_b","updateState","progressMs","player","getCurrentState","track_window","current_track","duration_ms","type","PROGRESS","error_1","isActive","togglePlay","error_2","syncTimeout","window","setTimeout","syncDevice","previousTrack","error_3","nextTrack","error_4","deviceId","isUnsupported","autoPlay","persistDeviceSelection","currentDeviceId","sessionStorage","setItem","is_playing","error_5","status","isSaved","FAVORITE","message","isPlaybackError","isInitializationError","nextStatus","devices","disconnect","UNSUPPORTED","ERROR","errorType","isInitializing","paused","album","name_1","next_tracks","previous_tracks","isPlaying","getVolume","volume","_c","setAlbumImage","trackState","nextTracks","previousTracks","__assign","error_6","device_id","initializeDevices","READY","IDLE","magnifySliderOnHover","previousState","isMagnified","Spotify","getOAuthToken","addListener","handlePlayerStatus","handlePlayerStateChanges","handlePlayerErrors","connect","width","min","apply","__spreadArray","images","map","thumb","find","url","emptyTrack","Error","item","progress_ms","device","volume_percent","error_7","offset","init","needsUpdate","shouldInitialize","getPlayOptions","playerState","activateElement","error_8","Number","isFinite","toFixed","seekUpdateInterval","error_9","setState","playerPosition","initialVolume","styles","SpotifyWebPlayer","ref","current","getBoundingClientRect","top","innerHeight","INITIALIZING","onSpotifyWebPlaybackSDKReady","initializePlayer","previousProps","playProp","showSaveIcon","syncExternalDevice","isReady","changedURIs","canPlay","shouldPlay","DEVICE","toggleSyncInterval","updateSeekBar","TRACK","toggleProgressBar","PLAYER","hasNewToken","toggleOffset","setExternalDevice","clearInterval","playerSyncInterval","playerProgressInterval","clearTimeout","Object","savedDeviceId_1","getItem","shouldSync","syncExternalDeviceInterval","setInterval","error_10","locale","updateSavedStatus","indexOf","localeMerged","output","info","onFavoriteStatusChange","handleFavoriteStatusChange","isExternalDevice","onClickNext","handleClickNext","onClickPrevious","handleClickPrevious","onClickTogglePlay","handleClickTogglePlay","isDevicesOpen","onClickDevice","handleClickDevice","onChangeRange","handleChangeRange","onToggleMagnify","handleToggleMagnify","PureComponent"],"sources":["/Users/shelvymurphy-brown/Desktop/spotify-react/client/node_modules/react-spotify-web-playback/src/index.tsx"],"sourcesContent":["/* eslint-disable camelcase */\nimport * as React from 'react';\nimport memoize from 'memoize-one';\n\nimport Actions from './components/Actions';\nimport Content from './components/Content';\nimport Controls from './components/Controls';\nimport ErrorMessage from './components/ErrorMessage';\nimport Info from './components/Info';\nimport Loader from './components/Loader';\nimport Player from './components/Player';\nimport Slider from './components/Slider';\nimport {\n  getDevices,\n  getPlaybackState,\n  next,\n  pause,\n  play,\n  previous,\n  seek,\n  setDevice,\n  setVolume,\n} from './spotify';\nimport { getMergedStyles } from './styles';\nimport {\n  PlayOptions,\n  Props,\n  SpotifyDevice,\n  SpotifyPlayerCallback,\n  SpotifyPlayerStatus,\n  State,\n  StylesOptions,\n  WebPlaybackAlbum,\n  WebPlaybackArtist,\n  WebPlaybackError,\n  WebPlaybackImage,\n  WebPlaybackPlayer,\n  WebPlaybackReady,\n  WebPlaybackState,\n} from './types';\nimport {\n  getLocale,\n  getSpotifyURIType,\n  isEqualArray,\n  loadSpotifyPlayer,\n  parseVolume,\n  round,\n  STATUS,\n  TYPE,\n  validateURI,\n} from './utils';\n\nclass SpotifyWebPlayer extends React.PureComponent<Props, State> {\n  private isActive = false;\n  private emptyTrack = {\n    artists: [] as WebPlaybackArtist[],\n    durationMs: 0,\n    id: '',\n    image: '',\n    name: '',\n    uri: '',\n  };\n\n  private getPlayOptions = memoize((data): PlayOptions => {\n    const playOptions: PlayOptions = {\n      context_uri: undefined,\n      uris: undefined,\n    };\n\n    /* istanbul ignore else */\n    if (data) {\n      const ids = Array.isArray(data) ? data : [data];\n\n      if (!ids.every(d => validateURI(d))) {\n        // eslint-disable-next-line no-console\n        console.error('Invalid URI');\n\n        return playOptions;\n      }\n\n      if (ids.some(d => getSpotifyURIType(d) === 'track')) {\n        if (!ids.every(d => getSpotifyURIType(d) === 'track')) {\n          // eslint-disable-next-line no-console\n          console.warn(\"You can't mix tracks URIs with other types\");\n        }\n\n        playOptions.uris = ids.filter(d => validateURI(d) && getSpotifyURIType(d) === 'track');\n      } else {\n        if (ids.length > 1) {\n          // eslint-disable-next-line no-console\n          console.warn(\"Albums, Artists, Playlists and Podcasts can't have multiple URIs\");\n        }\n\n        // eslint-disable-next-line prefer-destructuring\n        playOptions.context_uri = ids[0];\n      }\n    }\n\n    return playOptions;\n  });\n\n  private hasNewToken = false;\n  private player?: WebPlaybackPlayer;\n  private playerProgressInterval?: number;\n  private playerSyncInterval?: number;\n  private ref = React.createRef<HTMLDivElement>();\n  private seekUpdateInterval = 100;\n  private readonly styles: StylesOptions;\n  private syncTimeout?: number;\n\n  constructor(props: Props) {\n    super(props);\n\n    this.state = {\n      currentDeviceId: '',\n      deviceId: '',\n      devices: [],\n      error: '',\n      errorType: '',\n      isActive: false,\n      isInitializing: false,\n      isMagnified: false,\n      isPlaying: false,\n      isSaved: false,\n      isUnsupported: false,\n      needsUpdate: false,\n      nextTracks: [],\n      playerPosition: 'bottom',\n      position: 0,\n      previousTracks: [],\n      progressMs: 0,\n      status: STATUS.IDLE,\n      track: this.emptyTrack,\n      volume: parseVolume(props.initialVolume) || 1,\n    };\n\n    this.styles = getMergedStyles(props.styles);\n  }\n\n  // eslint-disable-next-line react/static-property-placement\n  static defaultProps = {\n    callback: () => undefined,\n    magnifySliderOnHover: false,\n    name: 'Spotify Web Player',\n    showSaveIcon: false,\n    syncExternalDeviceInterval: 5,\n    syncExternalDevice: false,\n  };\n\n  public async componentDidMount() {\n    this.isActive = true;\n    const { top = 0 } = this.ref.current?.getBoundingClientRect() || {};\n\n    this.updateState({\n      playerPosition: top > window.innerHeight / 2 ? 'bottom' : 'top',\n      status: STATUS.INITIALIZING,\n    });\n\n    if (!window.onSpotifyWebPlaybackSDKReady) {\n      window.onSpotifyWebPlaybackSDKReady = this.initializePlayer;\n    } else {\n      this.initializePlayer();\n    }\n\n    await loadSpotifyPlayer();\n  }\n\n  public async componentDidUpdate(previousProps: Props, previousState: State) {\n    const { currentDeviceId, deviceId, error, isInitializing, isPlaying, status, track } =\n      this.state;\n    const {\n      autoPlay,\n      callback,\n      offset,\n      play: playProp,\n      showSaveIcon,\n      syncExternalDevice,\n      token,\n      uris,\n    } = this.props;\n    const isReady = previousState.status !== STATUS.READY && status === STATUS.READY;\n    const changedURIs = Array.isArray(uris)\n      ? !isEqualArray(previousProps.uris, uris)\n      : previousProps.uris !== uris;\n    const playOptions = this.getPlayOptions(uris);\n\n    const canPlay = !!currentDeviceId && !!(playOptions.context_uri || playOptions.uris);\n    const shouldPlay = (changedURIs && isPlaying) || !!(isReady && (autoPlay || playProp));\n\n    if (canPlay && shouldPlay) {\n      await play(token, { deviceId: currentDeviceId, offset, ...playOptions });\n\n      /* istanbul ignore else */\n      if (!isPlaying) {\n        this.updateState({ isPlaying: true });\n      }\n\n      if (this.isExternalPlayer) {\n        this.syncTimeout = window.setTimeout(() => {\n          this.syncDevice();\n        }, 600);\n      }\n    } else if (changedURIs && !isPlaying) {\n      this.updateState({ needsUpdate: true });\n    }\n\n    if (previousState.status !== status) {\n      callback!({\n        ...this.state,\n        type: TYPE.STATUS,\n      });\n    }\n\n    if (previousState.currentDeviceId !== currentDeviceId && currentDeviceId) {\n      if (!isReady) {\n        callback!({\n          ...this.state,\n          type: TYPE.DEVICE,\n        });\n      }\n\n      await this.toggleSyncInterval(this.isExternalPlayer);\n      await this.updateSeekBar();\n    }\n\n    if (previousState.track.id !== track.id && track.id) {\n      callback!({\n        ...this.state,\n        type: TYPE.TRACK,\n      });\n\n      if (showSaveIcon) {\n        this.updateState({ isSaved: false });\n      }\n    }\n\n    if (previousState.isPlaying !== isPlaying) {\n      this.toggleProgressBar();\n      await this.toggleSyncInterval(this.isExternalPlayer);\n\n      callback!({\n        ...this.state,\n        type: TYPE.PLAYER,\n      });\n    }\n\n    if (token && previousProps.token !== token) {\n      this.hasNewToken = true;\n\n      if (!isInitializing) {\n        this.initializePlayer();\n      } else {\n        this.hasNewToken = true;\n      }\n    }\n\n    if (previousProps.play !== playProp && playProp !== isPlaying) {\n      await this.togglePlay(!track.id);\n    }\n\n    if (previousProps.offset !== offset) {\n      await this.toggleOffset();\n    }\n\n    if (previousState.isInitializing && !isInitializing) {\n      if (error === 'authentication_error' && this.hasNewToken) {\n        this.hasNewToken = false;\n        this.initializePlayer();\n      }\n\n      if (syncExternalDevice && !uris) {\n        const player: SpotifyPlayerStatus = await getPlaybackState(token);\n\n        /* istanbul ignore else */\n        if (player && player.is_playing && player.device.id !== deviceId) {\n          this.setExternalDevice(player.device.id);\n        }\n      }\n    }\n  }\n\n  public componentWillUnmount() {\n    this.isActive = false;\n\n    /* istanbul ignore else */\n    if (this.player) {\n      this.player.disconnect();\n    }\n\n    clearInterval(this.playerSyncInterval);\n    clearInterval(this.playerProgressInterval);\n    clearTimeout(this.syncTimeout);\n  }\n\n  private get isExternalPlayer(): boolean {\n    const { currentDeviceId, deviceId, status } = this.state;\n\n    return (currentDeviceId && currentDeviceId !== deviceId) || status === STATUS.UNSUPPORTED;\n  }\n\n  private handleChangeRange = async (position: number) => {\n    const { track } = this.state;\n    const { callback, token } = this.props;\n    let progress = 0;\n\n    try {\n      const percentage = position / 100;\n\n      if (this.isExternalPlayer) {\n        progress = Math.round(track.durationMs * percentage);\n        await seek(token, progress);\n\n        this.updateState({\n          position,\n          progressMs: progress,\n        });\n      } else if (this.player) {\n        const state = (await this.player.getCurrentState()) as WebPlaybackState;\n\n        if (state) {\n          progress = Math.round(state.track_window.current_track.duration_ms * percentage);\n          await this.player.seek(progress);\n\n          this.updateState({\n            position,\n            progressMs: progress,\n          });\n        } else {\n          this.updateState({ position: 0 });\n        }\n      }\n\n      if (callback) {\n        callback({\n          ...this.state,\n          type: TYPE.PROGRESS,\n        });\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handleClickTogglePlay = async () => {\n    const { isActive } = this.state;\n\n    try {\n      await this.togglePlay(!this.isExternalPlayer && !isActive);\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handleClickPrevious = async () => {\n    try {\n      /* istanbul ignore else */\n      if (this.isExternalPlayer) {\n        const { token } = this.props;\n\n        await previous(token);\n        this.syncTimeout = window.setTimeout(() => {\n          this.syncDevice();\n        }, 300);\n      } else if (this.player) {\n        await this.player.previousTrack();\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handleClickNext = async () => {\n    try {\n      /* istanbul ignore else */\n      if (this.isExternalPlayer) {\n        const { token } = this.props;\n\n        await next(token);\n        this.syncTimeout = window.setTimeout(() => {\n          this.syncDevice();\n        }, 300);\n      } else if (this.player) {\n        await this.player.nextTrack();\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handleClickDevice = async (deviceId: string) => {\n    const { isUnsupported } = this.state;\n    const { autoPlay, persistDeviceSelection, token } = this.props;\n\n    this.updateState({ currentDeviceId: deviceId });\n\n    try {\n      await setDevice(token, deviceId);\n\n      /* istanbul ignore else */\n      if (persistDeviceSelection) {\n        sessionStorage.setItem('rswpDeviceId', deviceId);\n      }\n\n      /* istanbul ignore else */\n      if (isUnsupported) {\n        await this.syncDevice();\n\n        const player: SpotifyPlayerStatus = await getPlaybackState(token);\n\n        if (player && !player.is_playing && autoPlay) {\n          await this.togglePlay(true);\n        }\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handleFavoriteStatusChange = (status: boolean) => {\n    const { isSaved } = this.state;\n    const { callback } = this.props;\n\n    this.updateState({ isSaved: status });\n\n    /* istanbul ignore else */\n    if (isSaved !== status) {\n      callback!({\n        ...this.state,\n        isSaved: status,\n        type: TYPE.FAVORITE,\n      });\n    }\n  };\n\n  private handlePlayerErrors = async (type: string, message: string) => {\n    const { status } = this.state;\n    const isPlaybackError = type === 'playback_error';\n    const isInitializationError = type === 'initialization_error';\n    let nextStatus = status;\n    let devices: SpotifyDevice[] = [];\n\n    if (this.player && !isPlaybackError) {\n      await this.player.disconnect();\n    }\n\n    if (isInitializationError) {\n      nextStatus = STATUS.UNSUPPORTED;\n\n      const { token } = this.props;\n\n      ({ devices = [] } = await getDevices(token));\n    }\n\n    if (!isInitializationError && !isPlaybackError) {\n      nextStatus = STATUS.ERROR;\n    }\n\n    this.updateState({\n      devices,\n      error: message,\n      errorType: type,\n      isInitializing: false,\n      isUnsupported: isInitializationError,\n      status: nextStatus,\n    });\n  };\n\n  private handlePlayerStateChanges = async (state: WebPlaybackState | null) => {\n    try {\n      /* istanbul ignore else */\n      if (state) {\n        const {\n          paused,\n          position,\n          track_window: {\n            current_track: { album, artists, duration_ms, id, name, uri },\n            next_tracks,\n            previous_tracks,\n          },\n        } = state;\n\n        const isPlaying = !paused;\n        const volume = await this.player!.getVolume();\n        const track = {\n          artists,\n          durationMs: duration_ms,\n          id,\n          image: this.setAlbumImage(album),\n          name,\n          uri,\n        };\n        let trackState;\n\n        if (position === 0) {\n          trackState = {\n            nextTracks: next_tracks,\n            position: 0,\n            previousTracks: previous_tracks,\n            track,\n          };\n        }\n\n        this.updateState({\n          error: '',\n          errorType: '',\n          isActive: true,\n          isPlaying,\n          progressMs: position,\n          volume: round(volume),\n          ...trackState,\n        });\n      } else if (this.isExternalPlayer) {\n        await this.syncDevice();\n      } else {\n        this.updateState({\n          isActive: false,\n          isPlaying: false,\n          nextTracks: [],\n          position: 0,\n          previousTracks: [],\n          track: {\n            artists: '',\n            durationMs: 0,\n            id: '',\n            image: '',\n            name: '',\n            uri: '',\n          },\n        });\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private handlePlayerStatus = async ({ device_id }: WebPlaybackReady) => {\n    const { currentDeviceId, devices } = await this.initializeDevices(device_id);\n\n    this.updateState({\n      currentDeviceId,\n      deviceId: device_id,\n      devices,\n      isInitializing: false,\n      status: device_id ? STATUS.READY : STATUS.IDLE,\n    });\n  };\n\n  private handleToggleMagnify = () => {\n    const { magnifySliderOnHover } = this.props;\n\n    if (magnifySliderOnHover) {\n      this.updateState((previousState: State) => {\n        return { isMagnified: !previousState.isMagnified };\n      });\n    }\n  };\n\n  private async initializeDevices(id: string) {\n    const { persistDeviceSelection, token } = this.props;\n    const { devices } = await getDevices(token);\n    let currentDeviceId = id;\n\n    if (persistDeviceSelection) {\n      const savedDeviceId = sessionStorage.getItem('rswpDeviceId');\n\n      /* istanbul ignore else */\n      if (!savedDeviceId || !devices.some((d: SpotifyDevice) => d.id === savedDeviceId)) {\n        sessionStorage.setItem('rswpDeviceId', currentDeviceId);\n      } else {\n        currentDeviceId = savedDeviceId;\n      }\n    }\n\n    return { currentDeviceId, devices };\n  }\n\n  private initializePlayer = () => {\n    const { volume } = this.state;\n    const { name, token } = this.props;\n\n    this.updateState({ isInitializing: true });\n\n    // @ts-ignore\n    this.player = new window.Spotify.Player({\n      getOAuthToken: (callback: SpotifyPlayerCallback) => {\n        callback(token);\n      },\n      name,\n      volume,\n    }) as WebPlaybackPlayer;\n\n    this.player.addListener('ready', this.handlePlayerStatus);\n    this.player.addListener('not_ready', this.handlePlayerStatus);\n    this.player.addListener('player_state_changed', this.handlePlayerStateChanges);\n    this.player.addListener('initialization_error', (error: WebPlaybackError) =>\n      this.handlePlayerErrors('initialization_error', error.message),\n    );\n    this.player.addListener('authentication_error', (error: WebPlaybackError) =>\n      this.handlePlayerErrors('authentication_error', error.message),\n    );\n    this.player.addListener('account_error', (error: WebPlaybackError) =>\n      this.handlePlayerErrors('account_error', error.message),\n    );\n    this.player.addListener('playback_error', (error: WebPlaybackError) =>\n      this.handlePlayerErrors('playback_error', error.message),\n    );\n\n    this.player.connect();\n  };\n\n  // eslint-disable-next-line class-methods-use-this\n  private setAlbumImage = (album: WebPlaybackAlbum): string => {\n    const width = Math.min(...album.images.map(d => d.width));\n    const thumb: WebPlaybackImage =\n      album.images.find(d => d.width === width) || ({} as WebPlaybackImage);\n\n    return thumb.url;\n  };\n\n  private setExternalDevice = (id: string) => {\n    this.updateState({ currentDeviceId: id, isPlaying: true });\n  };\n\n  private setVolume = async (volume: number) => {\n    const { token } = this.props;\n\n    /* istanbul ignore else */\n    if (this.isExternalPlayer) {\n      await setVolume(token, Math.round(volume * 100));\n      await this.syncDevice();\n    } else if (this.player) {\n      await this.player.setVolume(volume);\n    }\n\n    this.updateState({ volume });\n  };\n\n  private syncDevice = async () => {\n    if (!this.isActive) {\n      return;\n    }\n\n    const { deviceId } = this.state;\n    const { token } = this.props;\n\n    try {\n      const player: SpotifyPlayerStatus = await getPlaybackState(token);\n      let track = this.emptyTrack;\n\n      if (!player) {\n        throw new Error('No player');\n      }\n\n      /* istanbul ignore else */\n      if (player.item) {\n        track = {\n          artists: player.item.artists,\n          durationMs: player.item.duration_ms,\n          id: player.item.id,\n          image: this.setAlbumImage(player.item.album),\n          name: player.item.name,\n          uri: player.item.uri,\n        };\n      }\n\n      this.updateState({\n        error: '',\n        errorType: '',\n        isActive: true,\n        isPlaying: player.is_playing,\n        nextTracks: [],\n        previousTracks: [],\n        progressMs: player.item ? player.progress_ms : 0,\n        status: STATUS.READY,\n        track,\n        volume: parseVolume(player.device.volume_percent),\n      });\n    } catch (error: any) {\n      const state = {\n        isActive: false,\n        isPlaying: false,\n        position: 0,\n        track: this.emptyTrack,\n      };\n\n      if (deviceId) {\n        this.updateState({\n          currentDeviceId: deviceId,\n          ...state,\n        });\n\n        return;\n      }\n\n      this.updateState({\n        error: error.message,\n        errorType: 'player_status',\n        status: STATUS.ERROR,\n        ...state,\n      });\n    }\n  };\n\n  private async toggleSyncInterval(shouldSync: boolean) {\n    const { syncExternalDeviceInterval } = this.props;\n\n    try {\n      if (this.isExternalPlayer && shouldSync && !this.playerSyncInterval) {\n        await this.syncDevice();\n\n        clearInterval(this.playerSyncInterval);\n        this.playerSyncInterval = window.setInterval(\n          this.syncDevice,\n          syncExternalDeviceInterval! * 1000,\n        );\n      }\n\n      if ((!shouldSync || !this.isExternalPlayer) && this.playerSyncInterval) {\n        clearInterval(this.playerSyncInterval);\n        this.playerSyncInterval = undefined;\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n\n  private toggleProgressBar() {\n    const { isPlaying } = this.state;\n\n    /* istanbul ignore else */\n    if (isPlaying) {\n      /* istanbul ignore else */\n      if (!this.playerProgressInterval) {\n        this.playerProgressInterval = window.setInterval(\n          this.updateSeekBar,\n          this.seekUpdateInterval,\n        );\n      }\n    } else if (this.playerProgressInterval) {\n      clearInterval(this.playerProgressInterval);\n      this.playerProgressInterval = undefined;\n    }\n  }\n\n  private toggleOffset = async () => {\n    const { currentDeviceId, isPlaying } = this.state;\n    const { offset, token, uris } = this.props;\n\n    if (isPlaying && typeof offset === 'number' && Array.isArray(uris)) {\n      await play(token, { deviceId: currentDeviceId, offset, uris });\n    }\n  };\n\n  private togglePlay = async (init = false) => {\n    const { currentDeviceId, isPlaying, needsUpdate } = this.state;\n    const { offset, token, uris } = this.props;\n    const shouldInitialize = init || needsUpdate;\n    const playOptions = this.getPlayOptions(uris);\n\n    try {\n      /* istanbul ignore else */\n      if (this.isExternalPlayer) {\n        if (!isPlaying) {\n          await play(token, {\n            deviceId: currentDeviceId,\n            offset,\n            ...(shouldInitialize ? playOptions : undefined),\n          });\n        } else {\n          await pause(token);\n\n          this.updateState({ isPlaying: false });\n        }\n\n        this.syncTimeout = window.setTimeout(() => {\n          this.syncDevice();\n        }, 300);\n      } else if (this.player) {\n        const playerState = await this.player.getCurrentState();\n\n        this.player.activateElement();\n\n        // eslint-disable-next-line unicorn/prefer-ternary\n        if (\n          (!playerState && !!(playOptions.context_uri || playOptions.uris)) ||\n          (shouldInitialize && playerState && playerState.paused)\n        ) {\n          await play(token, {\n            deviceId: currentDeviceId,\n            offset,\n            ...(shouldInitialize ? playOptions : undefined),\n          });\n        } else {\n          await this.player.togglePlay();\n        }\n      }\n\n      if (needsUpdate) {\n        this.updateState({ needsUpdate: false });\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private updateSeekBar = async () => {\n    if (!this.isActive) {\n      return;\n    }\n\n    const { progressMs, track } = this.state;\n\n    try {\n      /* istanbul ignore else */\n      if (this.isExternalPlayer) {\n        let position = progressMs / track.durationMs;\n\n        position = Number(((Number.isFinite(position) ? position : 0) * 100).toFixed(1));\n\n        this.updateState({\n          position,\n          progressMs: progressMs + this.seekUpdateInterval,\n        });\n      } else if (this.player) {\n        const state = (await this.player.getCurrentState()) as WebPlaybackState;\n\n        /* istanbul ignore else */\n        if (state) {\n          const progress = state.position;\n          const position = Number(\n            ((progress / state.track_window.current_track.duration_ms) * 100).toFixed(1),\n          );\n\n          this.updateState({\n            position,\n            progressMs: progress + this.seekUpdateInterval,\n          });\n        }\n      }\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  };\n\n  private updateState = (state = {}) => {\n    if (!this.isActive) {\n      return;\n    }\n\n    this.setState(state);\n  };\n\n  public render() {\n    const {\n      currentDeviceId,\n      deviceId,\n      devices,\n      error,\n      errorType,\n      isActive,\n      isMagnified,\n      isPlaying,\n      isUnsupported,\n      nextTracks,\n      playerPosition,\n      position,\n      previousTracks,\n      status,\n      track,\n      volume,\n    } = this.state;\n    const { locale, name, showSaveIcon, token, updateSavedStatus } = this.props;\n    const isReady = [STATUS.READY, STATUS.UNSUPPORTED].indexOf(status) >= 0;\n    const isPlaybackError = errorType === 'playback_error';\n    const localeMerged = getLocale(locale);\n\n    let output = <Loader styles={this.styles!} />;\n    let info;\n\n    if (isPlaybackError) {\n      info = <p>{error}</p>;\n    }\n\n    if (isReady) {\n      /* istanbul ignore else */\n      if (!info) {\n        info = (\n          <Info\n            isActive={isActive}\n            locale={localeMerged}\n            onFavoriteStatusChange={this.handleFavoriteStatusChange}\n            showSaveIcon={showSaveIcon!}\n            styles={this.styles}\n            token={token}\n            track={track}\n            updateSavedStatus={updateSavedStatus}\n          />\n        );\n      }\n\n      output = (\n        <>\n          <div>{info}</div>\n          <Controls\n            isExternalDevice={this.isExternalPlayer}\n            isPlaying={isPlaying}\n            locale={localeMerged}\n            nextTracks={nextTracks}\n            onClickNext={this.handleClickNext}\n            onClickPrevious={this.handleClickPrevious}\n            onClickTogglePlay={this.handleClickTogglePlay}\n            previousTracks={previousTracks}\n            styles={this.styles}\n          />\n          <Actions\n            currentDeviceId={currentDeviceId}\n            deviceId={deviceId}\n            devices={devices}\n            isDevicesOpen={isUnsupported && !deviceId}\n            locale={localeMerged}\n            onClickDevice={this.handleClickDevice}\n            playerPosition={playerPosition}\n            setVolume={this.setVolume}\n            styles={this.styles}\n            volume={volume}\n          />\n        </>\n      );\n    }\n\n    if (status === STATUS.ERROR) {\n      output = (\n        <ErrorMessage styles={this.styles}>\n          {name}: {error}\n        </ErrorMessage>\n      );\n    }\n\n    return (\n      <Player ref={this.ref} styles={this.styles}>\n        {isReady && (\n          <Slider\n            isMagnified={isMagnified}\n            onChangeRange={this.handleChangeRange}\n            onToggleMagnify={this.handleToggleMagnify}\n            position={position}\n            styles={this.styles!}\n          />\n        )}\n        <Content styles={this.styles}>{output}</Content>\n      </Player>\n    );\n  }\n}\n\nexport * from './types';\n\nexport default SpotifyWebPlayer;\n\nexport { STATUS, TYPE } from './utils';\n"]},"metadata":{},"sourceType":"module"}